<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Meeting Into Cryptid</title>
  <meta name="theme-color" content="#0b0b0b"/>
  <style>
    body{margin:0;font-family:system-ui,-apple-system;background:#0b0b0b;color:#fff}
    .wrap{padding:16px;max-width:820px;margin:0 auto;display:flex;flex-direction:column;gap:12px}
    textarea{width:100%;min-height:170px;background:#141414;color:#fff;border:1px solid #2a2a2a;border-radius:14px;padding:12px;outline:none}
    input{width:100%;background:#141414;color:#fff;border:1px solid #2a2a2a;border-radius:14px;padding:12px;outline:none}
    button{background:#7c3aed;color:#fff;border:0;border-radius:14px;padding:12px 14px;font-weight:900}
    button:disabled{background:#2a2a2a}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row button{flex:1;min-width:120px}
    .hint{color:#9ca3af;font-size:12px;line-height:1.35}
    .card{
      background: radial-gradient(1200px 500px at 10% 0%, rgba(124,58,237,.35), transparent),
                  radial-gradient(900px 500px at 100% 40%, rgba(16,185,129,.22), transparent),
                  #0f0f10;
      border:1px solid #2a2a2a;
      border-radius:18px;
      padding:14px;
      white-space:pre-wrap;
      line-height:1.35;
    }
    .title{font-weight:1000;font-size:18px;letter-spacing:.2px}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#1f1f22;border:1px solid #2a2a2a;font-size:12px;color:#d1d5db}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
    .small{font-size:12px;color:#cbd5e1}
    .saved{background:#101012;border:1px solid #2a2a2a;border-radius:14px;padding:12px;white-space:pre-wrap}
    a{color:#a78bfa}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Meeting Into Cryptid</div>
    <div class="hint">Paste any notes. It generates a weird “field guide” card you can share. No AI, just chaos.</div>

    <textarea id="input" placeholder="Paste meeting notes / class notes / life chaos here…"></textarea>
    <input id="location" placeholder="Optional: ‘habitat’ (e.g., My job / Group chat / Biology lab)"/>

    <div class="row">
      <button id="make">Summon Cryptid</button>
      <button id="worse">Make It Worse</button>
      <button id="copy">Copy Text</button>
      <button id="share">Share Card</button>
    </div>

    <div id="card" class="card"></div>

    <div class="row">
      <button id="save">Save</button>
      <button id="show">Show Saved</button>
      <button id="clear">Clear Saved</button>
    </div>
    <div id="saved" class="saved">No saved sightings yet.</div>

    <div class="hint">
      Tip: after you publish, open the link and “Add to Home Screen” for full-screen app vibes.
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const speciesA = ["Budget","Calendar","Feedback","Scope","Roadmap","Sync","Stakeholder","Deadline","Pipeline","Alignment","Compliance","Velocity","Deliverable","Metrics","Hiring","Policy","Retro","Standup","Incident","Quarterly","OKR"];
  const speciesB = ["Wraith","Moth","Golem","Hydra","Gremlin","Banshee","Specter","Slime","Worm","Chimera","Cryptid","Warden","Husk","Poltergeist","Sprite","Beast","Mirror","Fang","Oracle","Parasite","Orb"];
  const habitats = ["Open-plan tundra","Zoom marshlands","Email catacombs","Slack swamp","Calendar labyrinth","Spreadsheet canyon","Conference-room terrarium","Group-chat sinkhole","Dorm hallway","Kitchen at 2am","Library dusk zone"];
  const traits = [
    "Feeds on vague verbs and unowned tasks.",
    "Becomes visible only when someone says “quick question.”",
    "Sheds context every 3 minutes.",
    "Multiplies when you add more stakeholders.",
    "Hates clear deadlines; thrives on ‘sometime next week.’",
    "Migrates toward unmuted microphones.",
    "Carries a cursed link nobody can open.",
    "Steals meaning from bullet points.",
    "Leaves behind a sticky note smell of panic."
  ];
  const threat = ["Low (annoying)","Guarded (distracting)","Elevated (derailing)","High (schedule-eating)","Severe (soul-tax)","Mythic (career-event)"];
  const survival = [
    "Ask: who owns this? (Say it slowly.)",
    "Turn nouns into verbs. Then assign a name.",
    "Write one deadline with a date, not a vibe.",
    "Delete 50% of the meeting; keep the decision.",
    "If it’s unclear, reduce it to one sentence.",
    "If it’s urgent, create a checklist. If not, stop touching it.",
    "Translate ‘alignment’ into an actual choice.",
    "Screenshot the decision. Email it to the future."
  ];

  function pick(arr, seed){
    const x = Math.abs(Math.sin(seed) * 100000) % arr.length;
    return arr[Math.floor(x)];
  }

  function hashStr(s){
    let h = 2166136261;
    for (let i=0;i<s.length;i++){
      h ^= s.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return h >>> 0;
  }

  function keywords(text){
    const words = text.toLowerCase()
      .replace(/[^a-z0-9\s]/g," ")
      .split(/\s+/)
      .filter(w => w.length >= 4 && !["this","that","with","from","have","will","they","them","then","just","like","okay","going","into","about","more","some","very","what","when","where","your","youre","were","also"].includes(w));
    const freq = new Map();
    for (const w of words) freq.set(w, (freq.get(w)||0)+1);
    return [...freq.entries()].sort((a,b)=>b[1]-a[1]).slice(0,5).map(([w])=>w);
  }

  function makeCard(mode){
    const text = $("input").value.trim();
    const habUser = $("location").value.trim();

    if (!text){
      $("card").textContent = "Paste something first. The cryptid needs context crumbs.";
      return;
    }

    const seedBase = hashStr(text + "|" + habUser);
    const seed = seedBase + (mode==="worse" ? Math.floor(Math.random()*9999) : 0);

    const name = `${pick(speciesA, seed)} ${pick(speciesB, seed+1)}`;
    const habitat = habUser || pick(habitats, seed+2);
    const k = keywords(text);
    const tagLine = k.length ? `Attracted to: ${k.join(", ")}.` : "Attracted to: unnamed vibes.";

    const t1 = pick(traits, seed+3);
    const t2 = pick(traits, seed+4);
    const lvl = pick(threat, seed+5);

    // Choose 3 survival tips
    const s1 = pick(survival, seed+6);
    const s2 = pick(survival, seed+7);
    const s3 = pick(survival, seed+8);

    const excerpt = text.split("\n").map(l=>l.trim()).filter(Boolean).slice(0,4).join(" / ").slice(0,140);

    $("card").innerHTML =
`<div class="pill mono">FIELD GUIDE • UNVERIFIED SIGHTING</div>

<div style="margin-top:10px;font-weight:1000;font-size:20px">${name}</div>
<div class="small">Habitat: <span class="mono">${escapeHtml(habitat)}</span></div>
<div class="small">Threat level: <span class="mono">${lvl}</span></div>

<div style="margin-top:10px" class="small mono">${escapeHtml(tagLine)}</div>

<div style="margin-top:10px"><b>Observed behaviors</b>
<div class="mono small">• ${escapeHtml(t1)}
• ${escapeHtml(t2)}</div></div>

<div style="margin-top:10px"><b>Evidence fragment</b>
<div class="mono small">“${escapeHtml(excerpt || "—")}”</div></div>

<div style="margin-top:10px"><b>How to survive</b>
<div class="mono small">• ${escapeHtml(s1)}
• ${escapeHtml(s2)}
• ${escapeHtml(s3)}</div></div>

<div style="margin-top:10px" class="small">Generated locally. Share responsibly.</div>`;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  $("make").onclick = () => makeCard("normal");
  $("worse").onclick = () => makeCard("worse");

  $("copy").onclick = async () => {
    const text = $("card").innerText || "";
    try { await navigator.clipboard.writeText(text); alert("Copied."); }
    catch { alert("Copy failed (permission)."); }
  };

  async function cardToBlob(){
    // Render the card as an image using SVG foreignObject (works in most modern mobile browsers).
    const card = $("card");
    const rect = card.getBoundingClientRect();
    const w = Math.max(340, Math.min(900, Math.floor(rect.width)));
    const h = Math.max(420, Math.min(1400, Math.floor(rect.height)));

    const clone = card.cloneNode(true);
    clone.style.width = w + "px";
    clone.style.borderRadius = "18px";
    clone.style.padding = "14px";

    const css = [...document.styleSheets].map(s=>{
      try { return [...s.cssRules].map(r=>r.cssText).join("\n"); } catch { return ""; }
    }).join("\n");

    const html = `
      <div xmlns="http://www.w3.org/1999/xhtml">
        <style>${css}</style>
        ${clone.outerHTML}
      </div>
    `;

    const svg = `
      <svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}">
        <foreignObject width="100%" height="100%">${html}</foreignObject>
      </svg>
    `;

    const svgBlob = new Blob([svg], {type:"image/svg+xml;charset=utf-8"});
    const url = URL.createObjectURL(svgBlob);

    const img = new Image();
    img.src = url;
    await img.decode();

    const canvas = document.createElement("canvas");
    canvas.width = w * 2;
    canvas.height = h * 2;
    const ctx = canvas.getContext("2d");
    ctx.scale(2,2);
    ctx.drawImage(img, 0, 0, w, h);
    URL.revokeObjectURL(url);

    return await new Promise(resolve => canvas.toBlob(resolve, "image/png", 0.95));
  }

  $("share").onclick = async () => {
    try{
      // Ensure we have something
      if (!$("card").innerText.trim()) makeCard("normal");

      const blob = await cardToBlob();
      const file = new File([blob], "cryptid-card.png", { type: "image/png" });

      if (navigator.canShare && navigator.canShare({ files:[file] })) {
        await navigator.share({ files:[file], title:"Meeting Into Cryptid" });
      } else {
        // Fallback: open image in new tab
        const url = URL.createObjectURL(blob);
        window.open(url, "_blank");
        alert("If share didn’t open, long-press the image to save.");
      }
    } catch(e){
      alert("Share failed. Try Copy Text instead.");
    }
  };

  // Local saves (on this phone only)
  function loadItems(){
    try { return JSON.parse(localStorage.getItem("cryptids") || "[]"); }
    catch { return []; }
  }
  function saveItems(items){
    localStorage.setItem("cryptids", JSON.stringify(items));
  }

  $("save").onclick = () => {
    const text = $("input").value.trim();
    if(!text) return alert("Paste notes first.");
    if(!$("card").innerText.trim()) makeCard("normal");

    const items = loadItems();
    items.unshift({
      t: Date.now(),
      habitat: $("location").value.trim(),
      card: $("card").innerText
    });
    saveItems(items.slice(0,50));
    alert("Saved sighting (on this phone).");
  };

  $("show").onclick = () => {
    const items = loadItems();
    $("saved").textContent = items.length
      ? items.map(i => `• ${new Date(i.t).toLocaleString()} ${i.habitat?`(${i.habitat})`:``}\n${i.card}\n`).join("\n")
      : "No saved sightings yet.";
  };

  $("clear").onclick = () => {
    localStorage.removeItem("cryptids");
    $("saved").textContent = "No saved sightings yet.";
    alert("Cleared.");
  };

  // Initial card
  $("card").textContent = "Summon a cryptid by pasting notes and tapping “Summon Cryptid”.";
</script>
</body>
</html>
